
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>gfail.utilities &#8212; groundfailure 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for gfail.utilities</h1><div class="highlight"><pre>
<span></span><span class="c1"># stdlib imports</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="c1"># import numpy as np</span>
<span class="kn">import</span> <span class="nn">sqlite3</span> <span class="k">as</span> <span class="nn">lite</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># local imports</span>
<span class="kn">from</span> <span class="nn">mapio.shake</span> <span class="kn">import</span> <span class="n">getHeaderData</span>
<span class="kn">from</span> <span class="nn">libcomcat.search</span> <span class="kn">import</span> <span class="n">get_event_by_id</span><span class="p">,</span> <span class="n">search</span>
<span class="kn">from</span> <span class="nn">mapio.multihaz</span> <span class="kn">import</span> <span class="n">MultiHazardGrid</span>
<span class="kn">from</span> <span class="nn">gfail.stats</span> <span class="kn">import</span> <span class="n">get_rangebeta</span><span class="p">,</span> <span class="n">get_pdfbeta</span>
<span class="kn">from</span> <span class="nn">mapio.gdal</span> <span class="kn">import</span> <span class="n">GDALGrid</span>
<span class="kn">from</span> <span class="nn">mapio.gmt</span> <span class="kn">import</span> <span class="n">GMTGrid</span>


<span class="c1"># Don&#39;t delete this, it&#39;s needed in an eval function</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>  <span class="c1"># noqa</span>

<span class="c1"># DO NOT DELETE ABOVE LINE</span>

<span class="c1"># Define bin edges (lower and upper are clipped here but</span>
<span class="c1"># are not clipped in reality)</span>
<span class="n">lshbins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]</span>
<span class="n">lspbins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">]</span>
<span class="n">lqhbins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">]</span>
<span class="n">lqpbins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">]</span>


<div class="viewcode-block" id="is_grid_point_source"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.is_grid_point_source">[docs]</a><span class="k">def</span> <span class="nf">is_grid_point_source</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Was the shakemap grid constructed with a point source?</span>

<span class="sd">    This makes use of the &#39;urat&#39; layer, which is the ratio of the predicted</span>
<span class="sd">    ground motion standard deviation to the GMPE standard deviation. The only</span>
<span class="sd">    reason this could ever be greater than 1.0 is if the uncertainty of the</span>
<span class="sd">    prediction is inflated due to the point source approxmiation; further,</span>
<span class="sd">    if a point source was used, there will always be some</span>
<span class="sd">    locations with &#39;urat&#39; &gt; 1.0.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid (ShakeGrid): A ShakeGrid object from MapIO.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if point rupture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
    <span class="n">urat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;urat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
    <span class="n">max_urat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">urat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_urat</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="get_event_comcat"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.get_event_comcat">[docs]</a><span class="k">def</span> <span class="nf">get_event_comcat</span><span class="p">(</span><span class="n">shakefile</span><span class="p">,</span> <span class="n">timewindow</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">degwindow</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">magwindow</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find an event in comcat, searching first by event id and if that</span>
<span class="sd">    fails searching by magnitude, time, and location.</span>

<span class="sd">    Args:</span>
<span class="sd">        shakefile (str): path to shakemap .xml file of event to find</span>
<span class="sd">        timewindow (float): width of time window to search around time defined</span>
<span class="sd">            in shakefile (in seconds)</span>
<span class="sd">        degwindow (float): width of area to search around location specified in</span>
<span class="sd">            shakefile (in degrees).</span>
<span class="sd">        magwindow (float): width of magnitude window to search around the</span>
<span class="sd">            magnitude specified in shakefile.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None if event not found, else tuple (info, detail, shakemap) where,</span>
<span class="sd">            * info: json formatted dictionary of info.json for the event</span>
<span class="sd">            * detail: event detail from comcat</span>
<span class="sd">            * shakemap: shakemap of event found (from comcat)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header_dicts</span> <span class="o">=</span> <span class="n">getHeaderData</span><span class="p">(</span><span class="n">shakefile</span><span class="p">)</span>
    <span class="n">grid_dict</span> <span class="o">=</span> <span class="n">header_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">header_dicts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># version = grid_dict[&#39;shakemap_version&#39;]</span>
    <span class="n">shaketime</span> <span class="o">=</span> <span class="n">grid_dict</span><span class="p">[</span><span class="s2">&quot;process_timestamp&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;event_id&quot;</span><span class="p">]</span>
        <span class="n">net</span> <span class="o">=</span> <span class="s2">&quot;us&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;event_network&quot;</span> <span class="ow">in</span> <span class="n">event_dict</span><span class="p">:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;event_network&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eid</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="n">net</span> <span class="o">+</span> <span class="n">eid</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">get_event_by_id</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">includesuperseded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">]</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;event_timestamp&quot;</span><span class="p">]</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">timewindow</span><span class="p">)</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">timewindow</span><span class="p">)</span>
        <span class="n">minlat</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">-</span> <span class="n">degwindow</span>
        <span class="n">minlon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="n">degwindow</span>
        <span class="n">maxlat</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">degwindow</span>
        <span class="n">maxlon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">degwindow</span>
        <span class="n">minmag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mag</span> <span class="o">-</span> <span class="n">magwindow</span><span class="p">)</span>
        <span class="n">maxmag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mag</span> <span class="o">+</span> <span class="n">magwindow</span><span class="p">)</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span>
            <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span>
            <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">,</span>
            <span class="n">minmagnitude</span><span class="o">=</span><span class="n">minmag</span><span class="p">,</span>
            <span class="n">maxmagnitude</span><span class="o">=</span><span class="n">maxmag</span><span class="p">,</span>
            <span class="n">minlatitude</span><span class="o">=</span><span class="n">minlat</span><span class="p">,</span>
            <span class="n">minlongitude</span><span class="o">=</span><span class="n">minlon</span><span class="p">,</span>
            <span class="n">maxlatitude</span><span class="o">=</span><span class="n">maxlat</span><span class="p">,</span>
            <span class="n">maxlongitude</span><span class="o">=</span><span class="n">maxlon</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getDetailEvent</span><span class="p">()</span>
    <span class="n">allversions</span> <span class="o">=</span> <span class="n">detail</span><span class="o">.</span><span class="n">getProducts</span><span class="p">(</span><span class="s2">&quot;shakemap&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
    <span class="c1"># Find the right version</span>
    <span class="n">dates1</span> <span class="o">=</span> <span class="p">[</span><span class="n">allv</span><span class="o">.</span><span class="n">product_timestamp</span> <span class="k">for</span> <span class="n">allv</span> <span class="ow">in</span> <span class="n">allversions</span><span class="p">]</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dat</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]))</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">dates1</span><span class="p">])</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dates</span> <span class="o">-</span> <span class="n">shaketime</span><span class="p">))</span>
    <span class="c1"># vers = [allv.version for allv in allversions]</span>
    <span class="c1"># idx = np.where(np.array(vers) == version)[0][0]</span>
    <span class="n">shakemap</span> <span class="o">=</span> <span class="n">allversions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">infobytes</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">shakemap</span><span class="o">.</span><span class="n">getContentBytes</span><span class="p">(</span><span class="s2">&quot;info.json&quot;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">infobytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">info</span><span class="p">,</span> <span class="n">detail</span><span class="p">,</span> <span class="n">shakemap</span></div>


<div class="viewcode-block" id="parseConfigLayers"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.parseConfigLayers">[docs]</a><span class="k">def</span> <span class="nf">parseConfigLayers</span><span class="p">(</span><span class="n">maplayers</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse things that need to coodinate with each layer (like lims, logscale,</span>
<span class="sd">    colormaps etc.) from config file, in right order, where the order is from</span>
<span class="sd">    maplayers.</span>

<span class="sd">    Args:</span>
<span class="sd">        maplayers (dict): Dictionary containing model output.</span>
<span class="sd">        config (ConfigObj): Config object describing options for specific</span>
<span class="sd">            model.</span>
<span class="sd">        keys (list): List of keys of maplayers to process, e.g. ``[&#39;model&#39;]``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (plotorder, logscale, lims, colormaps, maskthreshes) where:</span>
<span class="sd">            * plotorder: maplayers keys in order of plotting.</span>
<span class="sd">            * logscale: list of logscale options from config corresponding to</span>
<span class="sd">              keys in plotorder (same order).</span>
<span class="sd">            * lims: list of colorbar limits from config corresponding to keys</span>
<span class="sd">              in plotorder (same order).</span>
<span class="sd">            * colormaps: list of colormaps from config corresponding to keys</span>
<span class="sd">              in plotorder (same order),</span>
<span class="sd">            * maskthreshes: list of mask thresholds from config corresponding</span>
<span class="sd">              to keys in plotorder (same order).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO:</span>
    <span class="c1">#    - Add ability to interpret custom color maps.</span>

    <span class="c1"># get all key names, create a plotorder list in case maplayers is not an</span>
    <span class="c1"># ordered dict, making sure that anything called &#39;model&#39; is first</span>
    <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">maplayers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plotorder</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">configkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">configkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;display_options&quot;</span><span class="p">][</span><span class="s2">&quot;lims&quot;</span><span class="p">]</span>
        <span class="n">lims</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">lims</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">configkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;display_options&quot;</span><span class="p">][</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
        <span class="n">colormaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">colormaps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">configkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;display_options&quot;</span><span class="p">][</span><span class="s2">&quot;logscale&quot;</span><span class="p">]</span>
        <span class="n">logscale</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">logscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">configkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;display_options&quot;</span><span class="p">][</span><span class="s2">&quot;maskthresholds&quot;</span><span class="p">]</span>
        <span class="n">maskthreshes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">maskthreshes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">configkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;display_options&quot;</span><span class="p">][</span><span class="s2">&quot;colors&quot;</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="n">default</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
        <span class="n">plotorder</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">lim1</span> <span class="ow">in</span> <span class="n">limits</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lim1</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="n">lim1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">getlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="n">lim1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">getlim</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="n">lim1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                            <span class="n">getlim</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getlim</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">lims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">getcol</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">colorobject</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">getcol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">colorobject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">colorobject</span> <span class="o">=</span> <span class="n">default</span>
                    <span class="n">colormaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colorobject</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">colormaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">logs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                <span class="n">getlog</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">logs</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                        <span class="n">getlog</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">logscale</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getlog</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">logscale</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">getmask</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">masks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">maskthreshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getmask</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">maskthreshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Reorder everything so model is first, if it&#39;s not already</span>
    <span class="k">if</span> <span class="n">plotorder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plotorder</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">indx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">firstpo</span> <span class="o">=</span> <span class="n">plotorder</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
            <span class="n">plotorder</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstpo</span><span class="p">]</span> <span class="o">+</span> <span class="n">plotorder</span>
            <span class="k">if</span> <span class="n">logscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logscale</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">firstlog</span> <span class="o">=</span> <span class="n">logscale</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
                <span class="n">logscale</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstlog</span><span class="p">]</span> <span class="o">+</span> <span class="n">logscale</span>
            <span class="k">if</span> <span class="n">lims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">firstlim</span> <span class="o">=</span> <span class="n">lims</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
                <span class="n">lims</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstlim</span><span class="p">]</span> <span class="o">+</span> <span class="n">lims</span>
            <span class="k">if</span> <span class="n">colormaps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">firstcol</span> <span class="o">=</span> <span class="n">colormaps</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
                <span class="n">colormaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstcol</span><span class="p">]</span> <span class="o">+</span> <span class="n">colormaps</span>

    <span class="k">return</span> <span class="n">plotorder</span><span class="p">,</span> <span class="n">logscale</span><span class="p">,</span> <span class="n">lims</span><span class="p">,</span> <span class="n">colormaps</span><span class="p">,</span> <span class="n">maskthreshes</span></div>


<div class="viewcode-block" id="text_to_json"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.text_to_json">[docs]</a><span class="k">def</span> <span class="nf">text_to_json</span><span class="p">(</span><span class="n">input1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simplification of text_to_json from shakelib.rupture.factory</span>

<span class="sd">    Args:</span>
<span class="sd">        input1 (str): url or filepath to text file</span>

<span class="sd">    Returns:</span>
<span class="sd">        json formatted stream of input1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input1</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># convert to geojson</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sline</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
            <span class="n">reference</span> <span class="o">+=</span> <span class="n">sline</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;Source: &quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">sline</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># start of new line segment</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># start of file</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">sline</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="k">continue</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">sline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fault file has no depths, assuming zero depth&quot;</span><span class="p">)</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lon</span><span class="p">):</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">poly</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">dep</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">poly</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reference&quot;</span><span class="p">:</span> <span class="n">reference</span><span class="p">},</span>
        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rupture type&quot;</span><span class="p">:</span> <span class="s2">&quot;rupture extent&quot;</span><span class="p">},</span>
                <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">coords</span><span class="p">]},</span>
            <span class="p">}</span>
        <span class="p">],</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_floats"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.write_floats">[docs]</a><span class="k">def</span> <span class="nf">write_floats</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">grid2d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a binary (with acc. header file) version of a Grid2D object.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): String filename to write (i.e., &#39;probability.flt&#39;)</span>
<span class="sd">        grid2d (Grid2D): MapIO Grid2D object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Given a filename input of &quot;probability.flt&quot;, this function will</span>
<span class="sd">        create that file, plus a text file called &quot;probability.hdr&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">geodict</span> <span class="o">=</span> <span class="n">grid2d</span><span class="o">.</span><span class="n">getGeoDict</span><span class="p">()</span><span class="o">.</span><span class="n">asDict</span><span class="p">()</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">grid2d</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
    <span class="n">npyfilename</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.npy&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">npyfilename</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">fpath</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">fbase</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">hdrfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">fbase</span> <span class="o">+</span> <span class="s2">&quot;.hdr&quot;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">hdrfile</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geodict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%i</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.4f</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="savelayers"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.savelayers">[docs]</a><span class="k">def</span> <span class="nf">savelayers</span><span class="p">(</span><span class="n">grids</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save ground failure layers object as a MultiHazard HDF file, preserving</span>
<span class="sd">    metadata structures. All layers must have same geodictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        grids: Ground failure layers object.</span>
<span class="sd">        filename (str): Path to where you want to save this file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        .hdf5 file containing ground failure layers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">layers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mgrid</span> <span class="o">=</span> <span class="n">MultiHazardGrid</span><span class="p">(</span>
        <span class="n">layers</span><span class="p">,</span> <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getGeoDict</span><span class="p">(),</span> <span class="n">origin</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span>
    <span class="p">)</span>
    <span class="n">mgrid</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="loadlayers"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.loadlayers">[docs]</a><span class="k">def</span> <span class="nf">loadlayers</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a MultiHazard HDF file back in as a ground failure layers object in</span>
<span class="sd">    active memory (must have been saved for this purpose).</span>
<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path to layers file (hdf5 extension).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Ground failure layers object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mgrid</span> <span class="o">=</span> <span class="n">MultiHazardGrid</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">grids</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mgrid</span><span class="o">.</span><span class="n">getLayerNames</span><span class="p">():</span>
        <span class="n">grids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="n">mgrid</span><span class="o">.</span><span class="n">getData</span><span class="p">()[</span><span class="n">key</span><span class="p">],</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">mgrid</span><span class="o">.</span><span class="n">getMetadata</span><span class="p">()[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">mgrid</span><span class="o">.</span><span class="n">getMetadata</span><span class="p">()[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">mgrid</span><span class="o">.</span><span class="n">getMetadata</span><span class="p">()[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">grids</span></div>


<div class="viewcode-block" id="get_alert"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.get_alert">[docs]</a><span class="k">def</span> <span class="nf">get_alert</span><span class="p">(</span>
    <span class="n">paramalertLS</span><span class="p">,</span>
    <span class="n">paramalertLQ</span><span class="p">,</span>
    <span class="n">parampopLS</span><span class="p">,</span>
    <span class="n">parampopLQ</span><span class="p">,</span>
    <span class="n">hazbinLS</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span>
    <span class="n">popbinLS</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
    <span class="n">hazbinLQ</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">],</span>
    <span class="n">popbinLQ</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">],</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get alert levels</span>

<span class="sd">    Args:</span>
<span class="sd">        paramalertLS (float): Hazard statistic of preferred landslide model</span>
<span class="sd">        paramalertLQ (float): Hazard statistic of preferred liquefaction model</span>
<span class="sd">        parampopLS (float): Exposure statistic of preferred landslide model</span>
<span class="sd">        parampopLQ (float): Exposure statistic of preferred liquefaction model</span>
<span class="sd">        hazbinLS (list): 3 element list of bin edges for landslide</span>
<span class="sd">            hazard alert between Green and Yellow, Yellow and Orange, and</span>
<span class="sd">            Orange and Red.</span>
<span class="sd">        popbinLS (list): same as above but for population exposure</span>
<span class="sd">        hazbinLQ (list): 3 element list of bin edges for liquefaction hazard</span>
<span class="sd">            alert between Green and Yellow, Yellow and Orange, and Orange</span>
<span class="sd">            and Red.</span>
<span class="sd">        popbinLQ (list): same as above but for population exposure</span>

<span class="sd">    Returns:</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (hazLS, popLS, hazLQ, popLQ, LS, LQ) where:</span>
<span class="sd">                * hazLS: the landslide hazard alert level (str)</span>
<span class="sd">                * popLS: the landslide population alert level (str)</span>
<span class="sd">                * hazLQ: the liquefaction hazard alert level (str)</span>
<span class="sd">                * popLQ: the liquefaction population alert level (str)</span>
<span class="sd">                * LS: the overall landslide alert level (str)</span>
<span class="sd">                * LQ: the overall liquefaction alert level (str)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">paramalertLS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">paramalertLS</span> <span class="o">&lt;</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLS</span> <span class="o">&gt;=</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">paramalertLS</span> <span class="o">&lt;</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLS</span> <span class="o">&gt;=</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">paramalertLS</span> <span class="o">&lt;</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLS</span> <span class="o">&gt;</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hazLS</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">parampopLS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">parampopLS</span> <span class="o">&lt;</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLS</span> <span class="o">&gt;=</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parampopLS</span> <span class="o">&lt;</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLS</span> <span class="o">&gt;=</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parampopLS</span> <span class="o">&lt;</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLS</span> <span class="o">&gt;=</span> <span class="n">popbinLS</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">popLS</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">paramalertLQ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">paramalertLQ</span> <span class="o">&lt;</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLQ</span> <span class="o">&gt;=</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">paramalertLQ</span> <span class="o">&lt;</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLQ</span> <span class="o">&gt;=</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">paramalertLQ</span> <span class="o">&lt;</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
    <span class="k">elif</span> <span class="n">paramalertLQ</span> <span class="o">&gt;=</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hazLQ</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">parampopLQ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">parampopLQ</span> <span class="o">&lt;</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLQ</span> <span class="o">&gt;=</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parampopLQ</span> <span class="o">&lt;</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLQ</span> <span class="o">&gt;=</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parampopLQ</span> <span class="o">&lt;</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
    <span class="k">elif</span> <span class="n">parampopLQ</span> <span class="o">&gt;=</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">popLQ</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">num2color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span>
    <span class="n">col2num</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">num2color</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">popLS</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">hazLS</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LSnum1</span> <span class="o">=</span> <span class="n">col2num</span><span class="p">[</span><span class="n">hazLS</span><span class="p">]</span>
        <span class="n">LSnum2</span> <span class="o">=</span> <span class="n">col2num</span><span class="p">[</span><span class="n">popLS</span><span class="p">]</span>
        <span class="n">LSnum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">LSnum1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">LSnum2</span><span class="p">)]))</span>
        <span class="n">LS</span> <span class="o">=</span> <span class="n">num2color</span><span class="p">[</span><span class="n">LSnum</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LS</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">popLQ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">hazLQ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LQnum1</span> <span class="o">=</span> <span class="n">col2num</span><span class="p">[</span><span class="n">hazLQ</span><span class="p">]</span>
        <span class="n">LQnum2</span> <span class="o">=</span> <span class="n">col2num</span><span class="p">[</span><span class="n">popLQ</span><span class="p">]</span>
        <span class="n">LQnum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">LQnum1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">LQnum2</span><span class="p">)]))</span>
        <span class="n">LQ</span> <span class="o">=</span> <span class="n">num2color</span><span class="p">[</span><span class="n">LQnum</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LQ</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">hazLS</span><span class="p">,</span> <span class="n">popLS</span><span class="p">,</span> <span class="n">hazLQ</span><span class="p">,</span> <span class="n">popLQ</span><span class="p">,</span> <span class="n">LS</span><span class="p">,</span> <span class="n">LQ</span></div>


<div class="viewcode-block" id="view_database"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.view_database">[docs]</a><span class="k">def</span> <span class="nf">view_database</span><span class="p">(</span>
    <span class="n">database</span><span class="p">,</span>
    <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eventids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">realtime</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">currentonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">numevents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LShazmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LShazmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LSpopmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LSpopmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LQhazmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LQhazmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LQpopmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">LQpopmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">printcols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">csvfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">printsummary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">printsuccess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">printfailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">printnotmet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">maxcolwidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">alertreport</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">realtime_maxsec</span><span class="o">=</span><span class="mf">259200.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints out information from the ground failure database based on</span>
<span class="sd">    search criteria and other options. If nothing is defined except the</span>
<span class="sd">    database, it will print out a summary and details on the successful</span>
<span class="sd">    event runs only.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): file path to event database (.db file)</span>
<span class="sd">        starttime (str): earliest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by np.datetime</span>
<span class="sd">        endtime (str): latest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by datetime</span>
<span class="sd">        minmag (float): minimum magnitude to include in search</span>
<span class="sd">        maxmag (float): maximum magnitude to include in search</span>
<span class="sd">        eventids (list): list of specific event ids to include (optional)</span>
<span class="sd">        realtime (bool): if True, will only include events that were run in</span>
<span class="sd">            near real time (defined by delay time less than realtime_maxsec)</span>
<span class="sd">        currentonly (bool): if True, will only include the most recent run</span>
<span class="sd">            of each event</span>
<span class="sd">        numevents (int): Include the numevents most recent events that meet</span>
<span class="sd">            search criteria</span>
<span class="sd">        LShazmin: minimum landslide hazard alert color (&#39;green&#39;, &#39;yellow&#39;,</span>
<span class="sd">            &#39;orange&#39;, &#39;red&#39;) or minimum hazard alert statistic value</span>
<span class="sd">        LShazmax: same as above but for maximum landslide hazard alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LSpopmin: same as above but for minimum landslide population alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LSpopmax: same as above but for maximum landslide population alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LQhazmin: same as above but for minimum liquefaction hazard alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LQhazmax: same as above but for maximum liquefaction hazard alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LQpopmin: same as above but for minimum liquefaction population alert</span>
<span class="sd">            value/color</span>
<span class="sd">        LQpopmax: same as above but for maximum liquefaction population alert</span>
<span class="sd">            value/color</span>
<span class="sd">        verbose (bool): if True, will print all columns (overridden if</span>
<span class="sd">                printcols is assigned)</span>
<span class="sd">        printcols (list): List of columns to print out (choose from id,</span>
<span class="sd">                  eventcode, shakemap_version, note, version, lat, lon, depth,</span>
<span class="sd">                  time, mag, location, starttime, endtime, eventdir,</span>
<span class="sd">                  finitefault, HaggLS, ExpPopLS, HaggLQ, ExpPopLQ</span>
<span class="sd">        csvfile: If defined, saves csvfile of table of all events found</span>
<span class="sd">            (includes all fields and failed/non-runs)</span>
<span class="sd">        printsummary (bool): if True (default), will print summary of events</span>
<span class="sd">            found to screen</span>
<span class="sd">        printsuccess (bool): if True (default), will print out database entries</span>
<span class="sd">            for successful event runs found</span>
<span class="sd">        printfailed (bool): if True (default False), will print out information</span>
<span class="sd">            about failed event runs</span>
<span class="sd">        printnotmet (bool): if True (default False), will print out information</span>
<span class="sd">            about event runs that didn&#39;t meet criteria to run ground failure</span>
<span class="sd">        maxcolwidth (int): maximum column width for printouts of database</span>
<span class="sd">            entries.</span>
<span class="sd">        alertreport (str): &#39;value&#39; if values of alert statistics should be</span>
<span class="sd">            printed, or &#39;color&#39; if alert level colors should be printed</span>
<span class="sd">        realtime_maxsec (float): if realtime is True, this is the maximum delay</span>
<span class="sd">            between event time and processing end time in seconds</span>
<span class="sd">            to consider an event to be run in realtime</span>

<span class="sd">    Returns:</span>
<span class="sd">        Prints summaries and database info to screen as requested, saves a</span>
<span class="sd">        csv file if requested. Also returns a tuple where (success, fail,</span>
<span class="sd">        notmet, stats, criteria) where</span>
<span class="sd">            * success: pandas dataframe of selected events that ran</span>
<span class="sd">                successfully</span>
<span class="sd">            * fail: pandas dataframe of selected events that failed to run</span>
<span class="sd">                due to an error</span>
<span class="sd">            * notmet: pandas dataframe of selected events that failed to run</span>
<span class="sd">                because they did not meet the criteria to run ground failure</span>
<span class="sd">            * stats: dictionary containing statistics summarizing selected</span>
<span class="sd">                events where</span>
<span class="sd">                * aLSg/y/o/r is the number of overall alerts of green/yellow</span>
<span class="sd">                    orange or red for landslides. If LS is replaced with LQ,</span>
<span class="sd">                    it is the same but for liquefaction.</span>
<span class="sd">                * hazLSg/y/o/r same as above but for hazard alert level totals</span>
<span class="sd">                * popLSg/y/o/r same as above but for population alert level</span>
<span class="sd">                    totals</span>
<span class="sd">                * nsuccess is the number of events that ran successfully</span>
<span class="sd">                * nfail is the number of events that failed to run</span>
<span class="sd">                * nnotmet is the number of events that didn&#39;t run because they</span>
<span class="sd">                    did not meet criteria to run ground failure</span>
<span class="sd">                * nunique is the number of unique earthquake events run</span>
<span class="sd">                * nunique_success is the number of unique earthquake events</span>
<span class="sd">                    that ran successfully</span>
<span class="sd">                * nrealtime is the number of events that ran in near-real-time</span>
<span class="sd">                * delay_median_s is the median delay time for near-real-time</span>
<span class="sd">                    events (earthquake time until first GF run), also the same</span>
<span class="sd">                    for mean, min, max, and standard deviation</span>
<span class="sd">            * criteria: dictionary containing info on what criteria were used</span>
<span class="sd">                for the search</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;{:%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
        <span class="s2">&quot;shakemap_version&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
        <span class="s2">&quot;starttime&quot;</span><span class="p">:</span> <span class="s2">&quot;{:%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
        <span class="s2">&quot;endtime&quot;</span><span class="p">:</span> <span class="s2">&quot;{:%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">criteria</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="c1"># Define alert bins for later use</span>
    <span class="n">hazbinLS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">green</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">yellow</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">orange</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="n">red</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1e20</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">popbinLS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">green</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="n">yellow</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">],</span>
        <span class="n">orange</span><span class="o">=</span><span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">],</span>
        <span class="n">red</span><span class="o">=</span><span class="p">[</span><span class="mf">10000.0</span><span class="p">,</span> <span class="mf">1e20</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">hazbinLQ</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">green</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="n">yellow</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span>
        <span class="n">orange</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">],</span>
        <span class="n">red</span><span class="o">=</span><span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">1e20</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">popbinLQ</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">green</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="n">yellow</span><span class="o">=</span><span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">],</span>
        <span class="n">orange</span><span class="o">=</span><span class="p">[</span><span class="mf">10000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">],</span>
        <span class="n">red</span><span class="o">=</span><span class="p">[</span><span class="mf">100000.0</span><span class="p">,</span> <span class="mf">1e20</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">lite</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

    <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="n">maxcolwidth</span>

    <span class="c1"># Read in entire shakemap table, do selection using pandas</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM shakemap&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;starttime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;starttime&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Print currently running info to screen</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="n">curt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Currently running&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ccols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;shakemap_version&quot;</span><span class="p">,</span> <span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="s2">&quot;starttime&quot;</span><span class="p">]</span>
        <span class="n">ccols2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;shake_v&quot;</span><span class="p">,</span> <span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="s2">&quot;startrun&quot;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Currently running - </span><span class="si">%d</span><span class="s2"> runs&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">curt</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">curt</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">ccols</span><span class="p">,</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="n">ccols2</span><span class="p">,</span>
                <span class="n">formatters</span><span class="o">=</span><span class="n">formatters</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Remove currently running from list</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">curt</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No events currently running&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>

    <span class="n">okcols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">eventids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">eventids</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
            <span class="n">eventids</span> <span class="o">=</span> <span class="p">[</span><span class="n">eventids</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">eventids</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">minmag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minmag</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">maxmag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">maxmag</span><span class="p">]</span>

    <span class="c1"># Narrow down the database based on input criteria</span>

    <span class="c1"># set default values for start and end</span>
    <span class="n">endt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;1700-01-01&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">endt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">endtime</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">stt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">endt</span><span class="p">)]</span>

    <span class="c1"># Winnow down based on alert</span>
    <span class="c1"># Assign numerical values if colors were used</span>

    <span class="k">if</span> <span class="n">LShazmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">LShazmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LShazmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LShazmin</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">LShazmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LShazmax</span> <span class="o">=</span> <span class="mf">1e20</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LShazmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LShazmin</span> <span class="o">=</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="n">LShazmin</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LShazmax</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LShazmax</span> <span class="o">=</span> <span class="n">hazbinLS</span><span class="p">[</span><span class="n">LShazmax</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">LShazmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">LShazmax</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">LQhazmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">LQhazmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LQhazmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LQhazmin</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">LQhazmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LQhazmax</span> <span class="o">=</span> <span class="mf">1e20</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LQhazmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LQhazmin</span> <span class="o">=</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="n">LQhazmin</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LQhazmax</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LQhazmax</span> <span class="o">=</span> <span class="n">hazbinLQ</span><span class="p">[</span><span class="n">LQhazmax</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">LQhazmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">LQhazmax</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">LSpopmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">LSpopmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LSpopmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LSpopmin</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">LSpopmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LSpopmax</span> <span class="o">=</span> <span class="mf">1e20</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LSpopmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LSpopmin</span> <span class="o">=</span> <span class="n">popbinLS</span><span class="p">[</span><span class="n">LSpopmin</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LSpopmax</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LSpopmax</span> <span class="o">=</span> <span class="n">popbinLS</span><span class="p">[</span><span class="n">LSpopmax</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">LSpopmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">LSpopmax</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">LQpopmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">LQpopmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LQpopmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LQpopmin</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">LQpopmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LQpopmax</span> <span class="o">=</span> <span class="mf">1e20</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LQpopmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LQpopmin</span> <span class="o">=</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="n">LQpopmin</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">LQpopmax</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">LQpopmax</span> <span class="o">=</span> <span class="n">popbinLQ</span><span class="p">[</span><span class="n">LQpopmax</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">LQpopmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">LQpopmax</span><span class="p">)]</span>

    <span class="c1"># Figure out which were run in real time</span>
    <span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">event_codes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">elist</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">event_codes</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rejects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
        <span class="n">vers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">][</span><span class="s2">&quot;shakemap_version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rejects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span>
        <span class="c1"># vermin = np.nanmin(vers)</span>
        <span class="c1"># sel1 = df.loc[(df[&#39;eventcode&#39;] == idx) &amp;</span>
        <span class="c1">#               (df[&#39;shakemap_version&#39;] == vermin)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">se</span> <span class="ow">in</span> <span class="n">sel1</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">dels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">se</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">se</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delay</span> <span class="o">&lt;=</span> <span class="n">realtime_maxsec</span><span class="p">:</span>
                <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rejects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">realtime</span><span class="p">:</span>  <span class="c1"># Keep just realtime events</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">keep</span><span class="p">)]</span>

    <span class="c1"># Remove any bad/incomplete entries</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rejects</span><span class="p">)]</span>

    <span class="c1"># Get only latest version for each event id if requested</span>
    <span class="k">if</span> <span class="n">currentonly</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">id1</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="c1"># Get most recent one for each</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">id1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">dels2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">te</span> <span class="ow">in</span> <span class="n">temp</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">dels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">te</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dels2</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">temp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;endtime&quot;</span><span class="p">],</span> <span class="s2">&quot;Current&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Current&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Keep just the most recent number requested</span>
    <span class="k">if</span> <span class="n">numevents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numevents</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="n">numevents</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>

    <span class="c1"># Now that have requested dataframe, make outputs</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;adjusted to&quot;</span><span class="p">))]</span>
    <span class="n">fail</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">)]</span>
    <span class="n">notmet</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">))</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;adjusted to&quot;</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No matching GF runs found&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">printcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">printcols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">okcols</span><span class="p">:</span>
                <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;column </span><span class="si">%s</span><span class="s2"> defined in printcols does not exist in the &quot;</span>
                    <span class="s2">&quot;database&quot;</span> <span class="o">%</span> <span class="n">p</span>
                <span class="p">)</span>
    <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">okcols</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># List of what we usually want to see</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;eventcode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mag&quot;</span><span class="p">,</span>
            <span class="s2">&quot;location&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shakemap_version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HaggLS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ExpPopLS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HaggLQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="c1"># Compute overall alert stats (just final for each event)</span>

    <span class="c1"># get unique event code list of full database</span>
    <span class="n">codes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">allevids</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nunique</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">allevids</span><span class="p">)</span>

    <span class="c1"># get unique event code list for success</span>
    <span class="n">event_codes</span> <span class="o">=</span> <span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">elist2</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">event_codes</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nunique_success</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elist2</span><span class="p">)</span>
    <span class="c1"># Get delays just for these events</span>
    <span class="n">delays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span>
    <span class="n">del_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elist2</span><span class="p">:</span>
        <span class="n">del_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delays</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">elist</span> <span class="o">==</span> <span class="n">el</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># get final alert values for each</span>
    <span class="n">hazalertLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hazalertLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">popalertLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">popalertLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLQ</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Currently includes just the most current one</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">elist2</span><span class="p">:</span>
        <span class="n">vers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
            <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">][</span><span class="s2">&quot;shakemap_version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="p">)</span>
        <span class="c1"># endt5 = np.nanmax(success.loc[success[&#39;eventcode&#39;] == idx]</span>
        <span class="c1">#                   [&#39;endtime&#39;].values)</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;shakemap_version&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">vers</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">get_alert</span><span class="p">(</span>
            <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">hazLS</span><span class="p">,</span> <span class="n">popLS</span><span class="p">,</span> <span class="n">hazLQ</span><span class="p">,</span> <span class="n">popLQ</span><span class="p">,</span> <span class="n">LS</span><span class="p">,</span> <span class="n">LQ</span> <span class="o">=</span> <span class="n">out</span>
        <span class="n">hazalertLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hazLS</span><span class="p">)</span>
        <span class="n">hazalertLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hazLQ</span><span class="p">)</span>
        <span class="n">popalertLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">popLS</span><span class="p">)</span>
        <span class="n">popalertLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">popLQ</span><span class="p">)</span>
        <span class="n">alertLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LS</span><span class="p">)</span>
        <span class="n">alertLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LQ</span><span class="p">)</span>

    <span class="n">origsuc</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Keep copy</span>

    <span class="c1"># Convert all values to alert colors</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">success</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">hazbinLS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">hazbinLQ</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">popbinLS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">popbinLQ</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>

    <span class="c1"># Compile stats</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">aLSg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">aLSy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">aLSo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">aLSr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">hazLSg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">hazLSy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">hazLSo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">hazLSr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">popLSg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">popLSy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">popLSo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">popLSr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLS</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">aLQg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">aLQy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">aLQo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">aLQr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">hazLQg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">hazLQy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">hazLQo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">hazLQr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">hazalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">popLQg</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">]),</span>
        <span class="n">popLQy</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]),</span>
        <span class="n">popLQo</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;orange&quot;</span><span class="p">]),</span>
        <span class="n">popLQr</span><span class="o">=</span><span class="nb">len</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">popalertLQ</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">]),</span>
        <span class="n">nsuccess</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">success</span><span class="p">),</span>
        <span class="n">nfail</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">fail</span><span class="p">),</span>
        <span class="n">nnotmet</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">notmet</span><span class="p">),</span>
        <span class="n">nruns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
        <span class="n">nunique</span><span class="o">=</span><span class="n">nunique</span><span class="p">,</span>
        <span class="n">nunique_success</span><span class="o">=</span><span class="n">nunique_success</span><span class="p">,</span>
        <span class="n">nrealtime</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">del_set</span><span class="p">)),</span>
        <span class="n">delay_median_s</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">delay_mean_s</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">delay_min_s</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">delay_max_s</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">delay_std_s</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">del_set</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_median_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">del_set</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_mean_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">del_set</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_min_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">del_set</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_max_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">del_set</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_std_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">del_set</span><span class="p">)</span>

    <span class="c1"># If date range not set by user</span>
    <span class="k">if</span> <span class="n">starttime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;starttime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endtime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">endtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Now output selections in text, csv files, figures</span>
    <span class="k">if</span> <span class="n">csvfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">csvfile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.csv&quot;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">csvfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">csvfile</span><span class="p">)</span>
        <span class="c1"># make sure it&#39;s a path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot save csv file to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">csvfile</span><span class="p">)</span>

    <span class="c1"># Print to screen</span>
    <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nsuccess&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">printsuccess</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successful - </span><span class="si">%d</span><span class="s2"> runs&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nsuccess&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="n">cols2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cols2</span><span class="p">[</span><span class="n">cols2</span> <span class="o">==</span> <span class="s2">&quot;shakemap_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;shake_v&quot;</span>  <span class="c1"># to save room printing</span>
        <span class="n">cols2</span><span class="p">[</span><span class="n">cols2</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gf_v&quot;</span>  <span class="c1"># to save room printing</span>
        <span class="n">cols2</span><span class="p">[</span><span class="n">cols2</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>  <span class="c1"># to save room printing</span>

        <span class="k">if</span> <span class="n">alertreport</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">success</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cols2</span><span class="p">),</span>
                    <span class="n">formatters</span><span class="o">=</span><span class="n">formatters</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">origsuc</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">cols2</span><span class="p">),</span>
                    <span class="n">formatters</span><span class="o">=</span><span class="n">formatters</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">printfailed</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nfail&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">failcols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;eventcode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shakemap_version&quot;</span><span class="p">,</span>
                <span class="s2">&quot;note&quot;</span><span class="p">,</span>
                <span class="s2">&quot;starttime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;endtime&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">failcols2</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;eventcode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shake_v&quot;</span><span class="p">,</span>
                <span class="s2">&quot;note&quot;</span><span class="p">,</span>
                <span class="s2">&quot;startrun&quot;</span><span class="p">,</span>
                <span class="s2">&quot;endrun&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="c1">#            if &#39;note&#39; not in cols:</span>
            <span class="c1">#                cols.append(&#39;note&#39;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed - </span><span class="si">%d</span><span class="s2"> runs&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nfail&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">fail</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">failcols</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">formatters</span><span class="o">=</span><span class="n">formatters</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="n">failcols2</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No failed runs found&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">printnotmet</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nnotmet&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">failcols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;eventcode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shakemap_version&quot;</span><span class="p">,</span>
                <span class="s2">&quot;note&quot;</span><span class="p">,</span>
                <span class="s2">&quot;starttime&quot;</span><span class="p">,</span>
                <span class="s2">&quot;endtime&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">failcols2</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;eventcode&quot;</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mag&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;shake_v&quot;</span><span class="p">,</span>
                <span class="s2">&quot;note&quot;</span><span class="p">,</span>
                <span class="s2">&quot;startrun&quot;</span><span class="p">,</span>
                <span class="s2">&quot;endrun&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Criteria not met - </span><span class="si">%d</span><span class="s2"> runs&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nnotmet&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">notmet</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">failcols</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="n">failcols2</span><span class="p">,</span>
                    <span class="n">formatters</span><span class="o">=</span><span class="n">formatters</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No runs failed to meet criteria&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">printsummary</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">starttime</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">endtime</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Of total of </span><span class="si">%d</span><span class="s2"> events run (</span><span class="si">%d</span><span class="s2"> unique)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nruns&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nunique&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Successful: </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> unique)&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nsuccess&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nunique_success&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Failed: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nfail&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Criteria not met: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nnotmet&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Realtime: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;nrealtime&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Median realtime delay: </span><span class="si">%1.1f</span><span class="s2"> mins&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;delay_median_s&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Landslide overall alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Liquefaction overall alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Landslide hazard alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Landslide population alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Liquefaction hazard alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Liquefaction population alerts&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Green: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQg&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Yellow: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQy&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orange: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQo&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQr&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">alertreport</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">origsuc</span><span class="p">,</span> <span class="n">fail</span><span class="p">,</span> <span class="n">notmet</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">criteria</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">fail</span><span class="p">,</span> <span class="n">notmet</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">criteria</span></div>


<div class="viewcode-block" id="alert_summary"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.alert_summary">[docs]</a><span class="k">def</span> <span class="nf">alert_summary</span><span class="p">(</span>
    <span class="n">database</span><span class="p">,</span>
    <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">realtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">currentonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">filebasename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">summarytypes</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print summary plot of alerts that have been issued for set of events met</span>
<span class="sd">    by defined criteria</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): file path to event database (.db file)</span>
<span class="sd">        starttime (str): earliest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by np.datetime</span>
<span class="sd">        endtime (str): latest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by datetime</span>
<span class="sd">        minmag (float): minimum magnitude to include in search</span>
<span class="sd">        maxmag (float): maximum magnitude to include in search</span>
<span class="sd">        realtime (bool): if True, will only include events that were run in</span>
<span class="sd">            near real time (defined by delay time less than realtime_maxsec)</span>
<span class="sd">        currentonly (bool): if True, will only include the most recent run</span>
<span class="sd">            of each event</span>
<span class="sd">        filebasename (str): If defined, will save a file with a modified</span>
<span class="sd">            version of this name depending on which alert is displayed, if no</span>
<span class="sd">            path is given it will save in current directory.</span>
<span class="sd">        summarytypes (str): if &#39;all&#39;, will create three figures, one for</span>
<span class="sd">            overall alerts, one for hazard alerts, and one for population</span>
<span class="sd">            alerts. If &#39;overall&#39;, &#39;hazard&#39;, or &#39;population&#39; it will create</span>
<span class="sd">            just the one selected.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of figure handles in order [&#39;overall&#39;, &#39;hazard&#39;, &#39;population&#39;]</span>
<span class="sd">        Figure files of alert level summaries</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">view_database</span><span class="p">(</span>
        <span class="n">database</span><span class="p">,</span>
        <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span>
        <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">,</span>
        <span class="n">minmag</span><span class="o">=</span><span class="n">minmag</span><span class="p">,</span>
        <span class="n">maxmag</span><span class="o">=</span><span class="n">maxmag</span><span class="p">,</span>
        <span class="n">realtime</span><span class="o">=</span><span class="n">realtime</span><span class="p">,</span>
        <span class="n">currentonly</span><span class="o">=</span><span class="n">currentonly</span><span class="p">,</span>
        <span class="n">printsummary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printsuccess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">alertreport</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">statsLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">statsLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;overall&quot;</span> <span class="ow">or</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">statsLS</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLSr&quot;</span><span class="p">]])</span>
        <span class="n">statsLQ</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;aLQr&quot;</span><span class="p">]])</span>
        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;overall&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;hazard&quot;</span> <span class="ow">or</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">statsLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLSr&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">statsLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hazLQr&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;hazard&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;population&quot;</span> <span class="ow">or</span> <span class="n">summarytypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">statsLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLSr&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">statsLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQg&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQy&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQo&quot;</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;popLQr&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;population&quot;</span><span class="p">)</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sLS</span><span class="p">,</span> <span class="n">sLQ</span><span class="p">,</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statsLS</span><span class="p">,</span> <span class="n">statsLQ</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.35</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">sLS</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Landslide Alerts&quot;</span>
        <span class="p">)</span>

        <span class="n">rects2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="n">bar_width</span><span class="p">,</span>
            <span class="n">sLQ</span><span class="p">,</span>
            <span class="n">bar_width</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Liquefaction Alerts&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rects1</span><span class="p">,</span> <span class="n">rects2</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mf">1.00</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="mf">1.05</span>
            <span class="n">r1</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">r1</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">r1</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">r1</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">val</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">r2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">r2</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">r2</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">val</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Alert&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Total Events&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ground failure </span><span class="si">%s</span><span class="s2"> alerts&quot;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="n">bar_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;Orange&quot;</span><span class="p">,</span> <span class="s2">&quot;Red&quot;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filebasename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filebasename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.png&quot;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figs</span></div>


<div class="viewcode-block" id="plot_evolution"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.plot_evolution">[docs]</a><span class="k">def</span> <span class="nf">plot_evolution</span><span class="p">(</span>
    <span class="n">database</span><span class="p">,</span>
    <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eventids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filebasename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">changeonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">percrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a plot and print stats showing delay times and changes in alert</span>
<span class="sd">        statistics over time</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): file path to event database (.db file)</span>
<span class="sd">        starttime (str): earliest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by np.datetime</span>
<span class="sd">        endtime (str): latest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by datetime</span>
<span class="sd">        minmag (float): minimum magnitude to include in search</span>
<span class="sd">        maxmag (float): maximum magnitude to include in search</span>
<span class="sd">        eventids (list): list of specific event ids to include (optional)</span>
<span class="sd">        filebasename (str): If defined, will save a file with a modified</span>
<span class="sd">            version of this name depending on which alert is displayed, if no</span>
<span class="sd">            path is given it will save in current directory.</span>
<span class="sd">        changeonly (bool): if True will only show events that changed alert</span>
<span class="sd">            level at least once in the time evolution plots (unless eventids</span>
<span class="sd">            are defined, then all will show)</span>
<span class="sd">        percrange: percentile to use for error bars to show uncertainty</span>
<span class="sd">            as value &lt;1 (e.g., 0.95). If None, errors will not be shown</span>


<span class="sd">    Returns:</span>
<span class="sd">        Figures showing alert changes over time and delay and alert change</span>
<span class="sd">            statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">view_database</span><span class="p">(</span>
        <span class="n">database</span><span class="p">,</span>
        <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span>
        <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">,</span>
        <span class="n">minmag</span><span class="o">=</span><span class="n">minmag</span><span class="p">,</span>
        <span class="n">maxmag</span><span class="o">=</span><span class="n">maxmag</span><span class="p">,</span>
        <span class="n">realtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">currentonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printsummary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printsuccess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">alertreport</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">eventids</span><span class="o">=</span><span class="n">eventids</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No events found that meet criteria&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eventids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">changeonly</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;starttime&quot;</span><span class="p">)</span>
    <span class="n">elist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">HaggLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">HaggLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ExpPopLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ExpPopLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eventtime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">descrip</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rangeHLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rangeHLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rangeELS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rangeELQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">hls</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">hlq</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">plq</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">als</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hls</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="n">plq</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">als1</span><span class="p">,</span> <span class="n">alq1</span> <span class="o">=</span> <span class="n">get_alert</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pq</span><span class="p">)</span>
            <span class="n">als</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">als1</span><span class="p">)</span>
            <span class="n">alq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alq1</span><span class="p">)</span>
        <span class="n">alertLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">als</span><span class="p">)</span>
        <span class="n">alertLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alq</span><span class="p">)</span>
        <span class="n">HaggLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hls</span><span class="p">)</span>
        <span class="n">HaggLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlq</span><span class="p">)</span>
        <span class="n">ExpPopLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span>
        <span class="n">ExpPopLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plq</span><span class="p">)</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">eventtime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">descrip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;M</span><span class="si">%1.1f</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">date</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">percrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">percrange</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">percrange</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;uncertrange must be between 0 and 1&quot;</span><span class="p">)</span>
            <span class="c1"># Get range for input percentile</span>
            <span class="c1"># range for H</span>
            <span class="n">range1</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;PH_LS&quot;</span><span class="p">],</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;QH_LS&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HlimLS&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">temp1</span> <span class="o">=</span> <span class="p">[</span><span class="n">hls</span> <span class="o">-</span> <span class="n">range1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">range1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hls</span><span class="p">]</span>
            <span class="n">temp1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">temp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># zero out any negative values</span>
            <span class="n">rangeHLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
            <span class="n">range2</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;PH_LQ&quot;</span><span class="p">],</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;QH_LQ&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HlimLQ&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">temp2</span> <span class="o">=</span> <span class="p">[</span><span class="n">hlq</span> <span class="o">-</span> <span class="n">range2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">range2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hlq</span><span class="p">]</span>
            <span class="n">temp2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">temp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># zero out any negative values</span>
            <span class="n">rangeHLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp2</span><span class="p">)</span>
            <span class="c1"># range for E</span>
            <span class="c1"># range for H</span>
            <span class="n">range3</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;PE_LS&quot;</span><span class="p">],</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;QE_LS&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ElimLS&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">temp3</span> <span class="o">=</span> <span class="p">[</span><span class="n">pls</span> <span class="o">-</span> <span class="n">range3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">range3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pls</span><span class="p">]</span>
            <span class="n">temp3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">temp3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">rangeELS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span>
            <span class="n">range4</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;PE_LQ&quot;</span><span class="p">],</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;QE_LQ&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ElimLQ&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">temp4</span> <span class="o">=</span> <span class="p">[</span><span class="n">plq</span> <span class="o">-</span> <span class="n">range4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">range4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">plq</span><span class="p">]</span>
            <span class="n">temp4</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">temp4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># zero out any negative values</span>
            <span class="n">rangeELQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nanmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel1</span><span class="p">)))</span>
            <span class="n">nanmat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="n">rangeHLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nanmat</span><span class="p">)</span>
            <span class="n">rangeHLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nanmat</span><span class="p">)</span>
            <span class="n">rangeELS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nanmat</span><span class="p">)</span>
            <span class="n">rangeELQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nanmat</span><span class="p">)</span>

    <span class="c1"># Plot of changes over time to each alert level</span>
    <span class="n">fig1</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># , figsize=(10, 10))</span>
    <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Landslide Summary Statistics&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Area Exposed to Hazard ($km^2$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Population Exposure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">fig2</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># , figsize=(10, 10))</span>
    <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Liquefaction Summary Statistics&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Area Exposed to Hazard ($km^2$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Population Exposure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hours after earthquake&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hours after earthquake&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">lqplot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lsplot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lsch</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lqch</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mindel</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">HaggLS</span><span class="p">,</span> <span class="n">HaggLQ</span><span class="p">,</span> <span class="n">ExpPopLS</span><span class="p">,</span> <span class="n">ExpPopLQ</span><span class="p">,</span> <span class="n">alertLS</span><span class="p">,</span> <span class="n">alertLQ</span><span class="p">,</span> <span class="n">descrip</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">eventtime</span>
    <span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">hls</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="n">plq</span><span class="p">,</span> <span class="n">als</span><span class="p">,</span> <span class="n">alq</span><span class="p">,</span> <span class="n">des</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">et</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">:</span>
        <span class="n">resS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">als</span><span class="p">)</span>
        <span class="n">resL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">alq</span><span class="p">)</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">et</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
        <span class="n">mindel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">delays</span><span class="p">))</span>
        <span class="c1"># Set to lower edge of green bin if zero so ratios will show up</span>
        <span class="n">hls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hls</span><span class="p">)</span>
        <span class="n">hls</span><span class="p">[</span><span class="n">hls</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lshbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hlq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hlq</span><span class="p">)</span>
        <span class="n">hlq</span><span class="p">[</span><span class="n">hlq</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqhbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span>
        <span class="n">pls</span><span class="p">[</span><span class="n">pls</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lspbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plq</span><span class="p">)</span>
        <span class="n">plq</span><span class="p">[</span><span class="n">plq</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lqpbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="s2">&quot;green&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resS</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">resL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="s2">&quot;green&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resL</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resS</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">changeonly</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">percrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">hls</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rangeHLS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">des</span>
                    <span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rangeELS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">hls</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">des</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">lshbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lshbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hls</span><span class="p">)))])</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">lspbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lspbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pls</span><span class="p">)))])</span>
                <span class="k">if</span> <span class="n">changeonly</span><span class="p">:</span>
                    <span class="n">lsch</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">lsplot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">changeonly</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">percrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rangeHLQ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">des</span>
                    <span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">plq</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">rangeELQ</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposx</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s2">&quot;clip&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">des</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delays</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">plq</span><span class="p">,</span> <span class="s2">&quot;.-&quot;</span><span class="p">)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">lqhbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lqhbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hlq</span><span class="p">)))])</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">lqpbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lqpbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">plq</span><span class="p">)))])</span>
                <span class="k">if</span> <span class="n">changeonly</span><span class="p">:</span>
                    <span class="n">lqch</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">lqplot</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> events had a liquefaction overall alert that changed&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">lqch</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> events had a landslide overall alert that changed&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">lsch</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">lsplot</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lqplot</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">alert_rectangles</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">lshbins</span><span class="p">)</span>
    <span class="n">alert_rectangles</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">lspbins</span><span class="p">)</span>
    <span class="n">alert_rectangles</span><span class="p">(</span><span class="n">ax3</span><span class="p">,</span> <span class="n">lqhbins</span><span class="p">)</span>
    <span class="n">alert_rectangles</span><span class="p">(</span><span class="n">ax4</span><span class="p">,</span> <span class="n">lqpbins</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filebasename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filebasename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.png&quot;</span>
        <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_LSalert_evolution</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_LQalert_evolution</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="time_delays"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.time_delays">[docs]</a><span class="k">def</span> <span class="nf">time_delays</span><span class="p">(</span>
    <span class="n">database</span><span class="p">,</span>
    <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">endtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxmag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eventids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filebasename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a plot and print stats showing delay times and changes in alert</span>
<span class="sd">        statistics over time</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): file path to event database (.db file)</span>
<span class="sd">        starttime (str): earliest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by np.datetime</span>
<span class="sd">        endtime (str): latest earthquake time to include in the search,</span>
<span class="sd">            can be any string date recognizable by datetime</span>
<span class="sd">        minmag (float): minimum magnitude to include in search</span>
<span class="sd">        maxmag (float): maximum magnitude to include in search</span>
<span class="sd">        eventids (list): list of specific event ids to include (optional)</span>
<span class="sd">        filebasename (str): If defined, will save a file with a modified</span>
<span class="sd">            version of this name depending on which alert is displayed, if no</span>
<span class="sd">            path is given it will save in current directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure showing delay and alert change statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">view_database</span><span class="p">(</span>
        <span class="n">database</span><span class="p">,</span>
        <span class="n">starttime</span><span class="o">=</span><span class="n">starttime</span><span class="p">,</span>
        <span class="n">endtime</span><span class="o">=</span><span class="n">endtime</span><span class="p">,</span>
        <span class="n">minmag</span><span class="o">=</span><span class="n">minmag</span><span class="p">,</span>
        <span class="n">maxmag</span><span class="o">=</span><span class="n">maxmag</span><span class="p">,</span>
        <span class="n">realtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">currentonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printsummary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">printsuccess</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">alertreport</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">eventids</span><span class="o">=</span><span class="n">eventids</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">success</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">elist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">HaggLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">HaggLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ExpPopLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ExpPopLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eventtime</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">alertLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">descrip</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">elist</span><span class="p">:</span>
        <span class="n">sel1</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">hls</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">hlq</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">plq</span> <span class="o">=</span> <span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">als</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hls</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="n">plq</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">als1</span><span class="p">,</span> <span class="n">alq1</span> <span class="o">=</span> <span class="n">get_alert</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pq</span><span class="p">)</span>
            <span class="n">als</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">als1</span><span class="p">)</span>
            <span class="n">alq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alq1</span><span class="p">)</span>
        <span class="n">alertLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">als</span><span class="p">)</span>
        <span class="n">alertLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alq</span><span class="p">)</span>
        <span class="n">HaggLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hls</span><span class="p">)</span>
        <span class="n">HaggLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlq</span><span class="p">)</span>
        <span class="n">ExpPopLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span>
        <span class="n">ExpPopLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plq</span><span class="p">)</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;endtime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">eventtime</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel1</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">success</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">success</span><span class="p">[</span><span class="s2">&quot;eventcode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">descrip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;M</span><span class="si">%1.1f</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">date</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">mindel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">delstableLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">delstableLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ratHaggLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ratHaggLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ratPopLS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ratPopLQ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">HaggLS</span><span class="p">,</span>
        <span class="n">HaggLQ</span><span class="p">,</span>
        <span class="n">ExpPopLS</span><span class="p">,</span>
        <span class="n">ExpPopLQ</span><span class="p">,</span>
        <span class="n">alertLS</span><span class="p">,</span>
        <span class="n">alertLQ</span><span class="p">,</span>
        <span class="n">descrip</span><span class="p">,</span>
        <span class="n">elist</span><span class="p">,</span>
        <span class="n">times</span><span class="p">,</span>
        <span class="n">eventtime</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">hls</span><span class="p">,</span> <span class="n">hlq</span><span class="p">,</span> <span class="n">pls</span><span class="p">,</span> <span class="n">plq</span><span class="p">,</span> <span class="n">als</span><span class="p">,</span> <span class="n">alq</span><span class="p">,</span> <span class="n">des</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">et</span> <span class="ow">in</span> <span class="n">zipped</span><span class="p">:</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">et</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
        <span class="n">mindel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">delays</span><span class="p">))</span>
        <span class="n">delstableLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delays</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">als</span><span class="p">)</span> <span class="o">==</span> <span class="n">als</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))])</span>
        <span class="n">delstableLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delays</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alq</span><span class="p">)</span> <span class="o">==</span> <span class="n">alq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))])</span>
        <span class="c1"># Set to lower edge of green bin if zero so ratios will show up</span>
        <span class="n">hls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hls</span><span class="p">)</span>
        <span class="n">hls</span><span class="p">[</span><span class="n">hls</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">ratHaggLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">hls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">hlq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hlq</span><span class="p">)</span>
        <span class="n">hlq</span><span class="p">[</span><span class="n">hlq</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">ratHaggLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">hlq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pls</span><span class="p">)</span>
        <span class="n">pls</span><span class="p">[</span><span class="n">pls</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span>
        <span class="n">ratPopLS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plq</span><span class="p">)</span>
        <span class="n">plq</span><span class="p">[</span><span class="n">plq</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">ratPopLQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">plq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Don&#39;t bother making this plot when eventids are specified</span>
    <span class="k">if</span> <span class="n">eventids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">eventids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="c1"># Histograms of delay times etc.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1000.0</span><span class="p">),</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mindel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span>
        <span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time delay to first run (hours)&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of events&quot;</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">mindel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">mindel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">mindel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># ax1.text(0.8, 0.8, &#39;mean: %1.1f hr\nmedian: %1.1f hr\nstd: %1.1f hr&#39; %</span>
        <span class="c1">#          vals, transform=ax1.transAxes, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.8</span><span class="p">,</span>
            <span class="mf">0.8</span><span class="p">,</span>
            <span class="s2">&quot;median: </span><span class="si">%1.1f</span><span class="s2"> hr&quot;</span> <span class="o">%</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">delstableLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delstableLS</span><span class="p">)</span>
        <span class="n">delstableLQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delstableLQ</span><span class="p">)</span>
        <span class="n">delstable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">delstableLS</span><span class="p">,</span> <span class="n">delstableLQ</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delstable</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time delay till final alert color reached (hours)&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of events&quot;</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">delstable</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">delstable</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">delstable</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># ax2.text(0.8, 0.8, &#39;mean: %1.1f hr\nmedian: %1.1f hr\nstd: %1.1f hr&#39; %</span>
        <span class="c1">#          vals, transform=ax2.transAxes, ha=&#39;center&#39;, va=&#39;center&#39;)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.8</span><span class="p">,</span>
            <span class="mf">0.8</span><span class="p">,</span>
            <span class="s2">&quot;median: </span><span class="si">%1.1f</span><span class="s2"> hr&quot;</span> <span class="o">%</span> <span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Liquefaction overall alerts that changed stablized after a &quot;</span>
            <span class="s2">&quot;median of </span><span class="si">%1.2f</span><span class="s2"> hours&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">delstableLQ</span><span class="p">[</span><span class="n">delstableLQ</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Landslide overall alerts that changed stablized after a median &quot;</span>
            <span class="s2">&quot;of </span><span class="si">%1.2f</span><span class="s2"> hours&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">delstableLS</span><span class="p">[</span><span class="n">delstableLS</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">3600.0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">ratHaggLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratHaggLS</span><span class="p">)</span>
        <span class="n">ratHaggLQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratHaggLQ</span><span class="p">)</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">100.0</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">ratHaggLS</span><span class="p">[</span><span class="n">ratHaggLS</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Landslides&quot;</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">ratHaggLQ</span><span class="p">[</span><span class="n">ratHaggLQ</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Liquefaction&quot;</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="c1"># ax3.set_xlabel(r&#39;$H_{agg}$ final/$H_{agg}$ initial&#39;)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Area Exposed to Hazard $H_</span><span class="si">{final}</span><span class="s2">/H_</span><span class="si">{initial}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of events&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
        <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="s2">&quot;No change:</span><span class="se">\n</span><span class="s2">LS=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">LQ=</span><span class="si">%d</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratHaggLS</span><span class="p">[</span><span class="n">ratHaggLS</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratHaggLQ</span><span class="p">[</span><span class="n">ratHaggLQ</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">])),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
            <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
            <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrowprops</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">handleheight</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>

        <span class="n">ratPopLS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratPopLS</span><span class="p">)</span>
        <span class="n">ratPopLQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratPopLQ</span><span class="p">)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">100.0</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">ratPopLS</span><span class="p">[</span><span class="n">ratPopLS</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">ratPopLQ</span><span class="p">[</span><span class="n">ratPopLQ</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Population Exposure $E_</span><span class="si">{final}</span><span class="s2">/E_</span><span class="si">{initial}</span><span class="s2">$&quot;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of events&quot;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="s2">&quot;No change:</span><span class="se">\n</span><span class="s2">LS=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">LQ=</span><span class="si">%d</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratPopLS</span><span class="p">[</span><span class="n">ratPopLS</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratPopLQ</span><span class="p">[</span><span class="n">ratPopLQ</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">])),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
            <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
            <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;axes fraction&quot;</span><span class="p">,</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrowprops</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add letters</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s2">&quot;a)&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s2">&quot;b)&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
        <span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s2">&quot;c)&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
        <span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="s2">&quot;d)&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax4</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filebasename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filebasename</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_alertdelay_stats</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_uncertainty"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.plot_uncertainty">[docs]</a><span class="k">def</span> <span class="nf">plot_uncertainty</span><span class="p">(</span>
    <span class="n">database</span><span class="p">,</span> <span class="n">eventid</span><span class="p">,</span> <span class="n">currentonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filebasename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">percrange</span><span class="o">=</span><span class="mf">0.95</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a plot and print stats showing delay times and changes in alert</span>
<span class="sd">        statistics over time</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): file path to event database (.db file)</span>
<span class="sd">        eventid (str): event ids to plot</span>
<span class="sd">        currentonly (bool): if True, will only plot newest version, if False</span>
<span class="sd">            will plot all versions with different colors</span>
<span class="sd">        filebasename (str): If defined, will save a file with a modified</span>
<span class="sd">            version of this name depending on which alert is displayed, if no</span>
<span class="sd">            path is given it will save in current directory.</span>
<span class="sd">        bars (bool): if True, will use bars spanning percrange</span>
<span class="sd">        percrange (float): percentile to use for error bars to show uncertainty</span>
<span class="sd">            as value &lt;1 (e.g., 0.95).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Figure showing uncertainty</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">view_database</span><span class="p">(</span>
        <span class="n">database</span><span class="p">,</span> <span class="n">eventids</span><span class="o">=</span><span class="p">[</span><span class="n">eventid</span><span class="p">],</span> <span class="n">currentonly</span><span class="o">=</span><span class="n">currentonly</span><span class="p">,</span> <span class="n">printsummary</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No events found that meet criteria&quot;</span><span class="p">)</span>

    <span class="n">success</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nvers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>
    <span class="c1"># Get plots ready</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">nvers</span><span class="p">))</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
    <span class="c1"># make last one thicker</span>
    <span class="n">widths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>

    <span class="c1"># Fill in plot</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">success</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">xvalsHLS</span><span class="p">,</span> <span class="n">yvalsHLS</span><span class="p">,</span> <span class="n">probsHLS</span> <span class="o">=</span> <span class="n">get_pdfbeta</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PH_LS&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QH_LS&quot;</span><span class="p">],</span> <span class="n">lshbins</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HlimLS&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bars</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PH_LS&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QH_LS&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HlimLS&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">xvalsHLS</span><span class="p">,</span>
                <span class="n">yvalsHLS</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yvalsHLS</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lshbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLS&quot;</span><span class="p">])),</span>
            <span class="n">offset</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># axes[0,0].text(row[&#39;HaggLS&#39;], 0.13, &#39;%1.0f&#39; % row[&#39;version&#39;],</span>
        <span class="c1">#               color=str(colors[i]), ha=&#39;center&#39;)</span>
        <span class="n">xvalsHLQ</span><span class="p">,</span> <span class="n">yvalsHLQ</span><span class="p">,</span> <span class="n">probsHLQ</span> <span class="o">=</span> <span class="n">get_pdfbeta</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PH_LQ&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QH_LQ&quot;</span><span class="p">],</span> <span class="n">lqhbins</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HlimLQ&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bars</span><span class="p">:</span>
            <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PH_LQ&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QH_LQ&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;HlimLQ&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">xvalsHLQ</span><span class="p">,</span>
                <span class="n">yvalsHLQ</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yvalsHLQ</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lqhbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;HaggLQ&quot;</span><span class="p">])),</span>
            <span class="n">offset</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># axes[0,1].text(row[&#39;HaggLQ&#39;], 0.13, &#39;%1.0f&#39; % row[&#39;version&#39;],</span>
        <span class="c1">#               color=str(colors[i]), ha=&#39;center&#39;)</span>
        <span class="n">xvalsELS</span><span class="p">,</span> <span class="n">yvalsELS</span><span class="p">,</span> <span class="n">probsELS</span> <span class="o">=</span> <span class="n">get_pdfbeta</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PE_LS&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QE_LS&quot;</span><span class="p">],</span> <span class="n">lspbins</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ElimLS&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bars</span><span class="p">:</span>
            <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PE_LS&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QE_LS&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ElimLS&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">xvalsELS</span><span class="p">,</span>
                <span class="n">yvalsELS</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yvalsELS</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lspbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLS&quot;</span><span class="p">])),</span>
            <span class="n">offset</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># axes[1,0].text(row[&#39;ExpPopLS&#39;], 0.13, &#39;%1.0f&#39; % row[&#39;version&#39;],</span>
        <span class="c1">#               color=str(colors[i]), ha=&#39;center&#39;)</span>
        <span class="n">xvalsELQ</span><span class="p">,</span> <span class="n">yvalsELQ</span><span class="p">,</span> <span class="n">probsELQ</span> <span class="o">=</span> <span class="n">get_pdfbeta</span><span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PE_LQ&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QE_LQ&quot;</span><span class="p">],</span> <span class="n">lqpbins</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ElimLQ&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bars</span><span class="p">:</span>
            <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span> <span class="o">=</span> <span class="n">get_rangebeta</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PE_LQ&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QE_LQ&quot;</span><span class="p">],</span> <span class="n">prob</span><span class="o">=</span><span class="n">percrange</span><span class="p">,</span> <span class="n">maxlim</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ElimLQ&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">xvalsELQ</span><span class="p">,</span>
                <span class="n">yvalsELQ</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yvalsELQ</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">lqpbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ExpPopLQ&quot;</span><span class="p">])),</span>
            <span class="n">offset</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># axes[1,1].text(row[&#39;ExpPopLQ&#39;], 0.13, &#39;%1.0f&#39; % row[&#39;version&#39;],</span>
        <span class="c1">#               color=str(colors[i]), ha=&#39;center&#39;)</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">bars</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="k">elif</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.7</span>

    <span class="k">if</span> <span class="n">nvers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.875</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">probsHLS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">probsHLQ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">probsELS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">probsELQ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">alertcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">lshbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
                <span class="n">lshbins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lshbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">alertcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">lspbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
                <span class="n">lspbins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lspbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">alertcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">lqhbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
                <span class="n">lqhbins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lqhbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">alertcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">lqpbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
                <span class="n">lqpbins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lqpbins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">alertcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;Estimated Area Exposed to Hazard ($km^2$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Estimated Population Exposure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;Estimated Area Exposed to Hazard ($km^2$)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Estimated Population Exposure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Landslides&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Liquefaction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lshbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lshbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lspbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lspbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lqhbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lqhbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lqpbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lqpbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax1</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
            <span class="c1">#            labels = [item.get_text() for item in ax1.get_xticklabels()]</span>
            <span class="c1">#            labels[0] = &#39;$\leq$%s&#39; % labels[0]</span>
            <span class="c1">#            labels[-1] = &#39;$\geq$%s&#39; % labels[-1]</span>
            <span class="c1">#            ax1.set_xticklabels(labels)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.065</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.13</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.13</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;%4.f - M</span><span class="si">%1.1f</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]),</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filebasename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filebasename</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_uncertainty</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="alert_rectangles"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.alert_rectangles">[docs]</a><span class="k">def</span> <span class="nf">alert_rectangles</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function used to color bin levels in background of axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span>
    <span class="n">xlims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y2</span><span class="p">],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="p">],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">corners</span> <span class="o">=</span> <span class="p">[[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">]]</span>
        <span class="c1"># add rectangle</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
            <span class="n">corners</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span></div>


<div class="viewcode-block" id="correct_config_filepaths"><a class="viewcode-back" href="../../gfail.utilities.html#gfail.utilities.correct_config_filepaths">[docs]</a><span class="k">def</span> <span class="nf">correct_config_filepaths</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an input filepath name and pre-pends it to all file locations within</span>
<span class="sd">    the config file. Individual locations are put into the config.  Don&#39;t have</span>
<span class="sd">    to put entire filepath location for each layer. Works by looping over</span>
<span class="sd">    config dictionary and subdictionary to fine locations named &#39;file&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_path (str): Path that needs to be appended to the front of all</span>
<span class="sd">            the file names/paths in config.</span>
<span class="sd">        config (ConfigObj): Object defining the model and its inputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        config dictionary with complete file paths.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Pull all other filepaths that need editing</span>
    <span class="k">for</span> <span class="n">keys1</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">keys1</span>
        <span class="k">for</span> <span class="n">keys2</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">keys2</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">],</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">second</span> <span class="o">==</span> <span class="s2">&quot;slopefile&quot;</span> <span class="ow">or</span> <span class="n">second</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
                    <span class="n">path_to_correct</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">]</span>
                    <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">path_to_correct</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">keys3</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">third</span> <span class="o">=</span> <span class="n">keys3</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">],</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">third</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">or</span> <span class="n">third</span> <span class="o">==</span> <span class="s2">&quot;filepath&quot;</span><span class="p">:</span>
                            <span class="n">path_to_correct</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">]</span>
                            <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">input_path</span><span class="p">,</span> <span class="n">path_to_correct</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">keys4</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">fourth</span> <span class="o">=</span> <span class="n">keys4</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span><span class="n">fourth</span><span class="p">],</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span>
                                <span class="ow">is</span> <span class="kc">False</span>
                            <span class="p">):</span>
                                <span class="k">if</span> <span class="n">fourth</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">or</span> <span class="n">fourth</span> <span class="o">==</span> <span class="s2">&quot;filepath&quot;</span><span class="p">:</span>
                                    <span class="n">path_to_correct</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span>
                                        <span class="n">fourth</span>
                                    <span class="p">]</span>
                                    <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span><span class="n">fourth</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="n">input_path</span><span class="p">,</span> <span class="n">path_to_correct</span>
                                    <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">keys5</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span>
                                    <span class="n">fourth</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">fifth</span> <span class="o">=</span> <span class="n">keys5</span>
                                    <span class="k">if</span> <span class="n">fifth</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">or</span> <span class="n">fifth</span> <span class="o">==</span> <span class="s2">&quot;filepath&quot;</span><span class="p">:</span>
                                        <span class="n">path_to_correct</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span>
                                            <span class="n">fourth</span>
                                        <span class="p">][</span><span class="n">fifth</span><span class="p">]</span>
                                        <span class="n">config</span><span class="p">[</span><span class="n">outer</span><span class="p">][</span><span class="n">second</span><span class="p">][</span><span class="n">third</span><span class="p">][</span><span class="n">fourth</span><span class="p">][</span>
                                            <span class="n">fifth</span>
                                        <span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">path_to_correct</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">groundfailure</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gfail.html">gfail</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>